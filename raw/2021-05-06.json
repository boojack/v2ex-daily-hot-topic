[{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1618811339","name":"qna","avatar_normal":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1618811339","title":"问与答","url":"https://www.v2ex.com/go/qna","topics":172096,"footer":"","header":"一个更好的世界需要你持续地提出好问题。","title_alternative":"Questions and Answers","avatar_mini":"https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1618811339","stars":3218,"aliases":[],"root":false,"id":12,"parent_node_name":"v2ex"},"member":{"username":"Pogbag","website":"shua1zh.github.io","github":"","psn":"","avatar_normal":"https://cdn.v2ex.com/avatar/a49b/0fdd/300244_mini.png?m=1609399441","bio":"","url":"https://www.v2ex.com/u/Pogbag","tagline":"","twitter":"","created":1521078466,"avatar_large":"https://cdn.v2ex.com/avatar/a49b/0fdd/300244_mini.png?m=1609399441","avatar_mini":"https://cdn.v2ex.com/avatar/a49b/0fdd/300244_mini.png?m=1609399441","location":"","btc":"","id":300244},"last_reply_by":"stephenyin","last_touched":1620271686,"title":"你们的 NAS 上都跑了什么服务","url":"https://www.v2ex.com/t/775071","created":1620264103,"content":"机型：DS220+/10G RAM/4T+1T HDD\r\n系统：DSM 6.2.4\r\n\r\n下载：download station/玩物下载 /qBittorent\r\n\r\n影音：Emby/tinyMediaManager/AVDC\r\n\r\n同步：Cloud Sync 同步百度网盘\r\n\r\nDocker：chrome 浏览器 访问内网路由器用的\r\n\r\n虚拟机：装了 win7 卡的要死 鼠标掉帧\r\n\r\n求推荐一些好玩的","content_rendered":"<p>机型：DS220+/10G RAM/4T+1T HDD\n系统：DSM 6.2.4</p>\n<p>下载：download station/玩物下载 /qBittorent</p>\n<p>影音：Emby/tinyMediaManager/AVDC</p>\n<p>同步：Cloud Sync 同步百度网盘</p>\n<p>Docker：chrome 浏览器 访问内网路由器用的</p>\n<p>虚拟机：装了 win7 卡的要死 鼠标掉帧</p>\n<p>求推荐一些好玩的</p>\n","last_modified":1620264103,"replies":33,"id":775071},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_large.png?m=1615111825","name":"apple","avatar_normal":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_normal.png?m=1615111825","title":"Apple","url":"https://www.v2ex.com/go/apple","topics":14756,"footer":"","header":"设计了 <a href=\"/go/watch\">Apple Watch</a>，<a href=\"/go/ipad\">iPad</a>，<a href=\"/go/iphone\">iPhone</a>，<a href=\"/go/imac\">iMac</a> 及 <a href=\"/go/mbp\">MacBook Pro</a> 等电子产品的美国公司。","title_alternative":"Apple","avatar_mini":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_mini.png?m=1615111825","stars":1799,"aliases":[],"root":false,"id":184,"parent_node_name":"hardware"},"member":{"username":"Cassano","website":null,"github":null,"psn":null,"avatar_normal":"https://cdn.v2ex.com/avatar/020c/daac/461815_mini.png?m=1577460505","bio":null,"url":"https://www.v2ex.com/u/Cassano","tagline":null,"twitter":null,"created":1577460265,"avatar_large":"https://cdn.v2ex.com/avatar/020c/daac/461815_mini.png?m=1577460505","avatar_mini":"https://cdn.v2ex.com/avatar/020c/daac/461815_mini.png?m=1577460505","location":null,"btc":null,"id":461815},"last_reply_by":"christin","last_touched":1620273061,"title":"为什么现在到处都在说拉垮，而且什么都能拉垮？还有什么不能拉垮的么？我觉得现在有些过度使用这个词汇了","url":"https://www.v2ex.com/t/775084","created":1620266457,"content":"","content_rendered":"","last_modified":1620266457,"replies":32,"id":775084},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1620107083","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1620107083","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":44356,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1620107083","stars":7361,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"username":"Grande","website":"onekeyes.cn","github":"onekeyes","psn":"","avatar_normal":"https://cdn.v2ex.com/avatar/cf19/b9fd/509722_mini.png?m=1615429038","bio":"","url":"https://www.v2ex.com/u/Grande","tagline":"","twitter":"","created":1601017082,"avatar_large":"https://cdn.v2ex.com/avatar/cf19/b9fd/509722_mini.png?m=1615429038","avatar_mini":"https://cdn.v2ex.com/avatar/cf19/b9fd/509722_mini.png?m=1615429038","location":"","btc":"","id":509722},"last_reply_by":"luolw1998","last_touched":1620272564,"title":"阿里云， HK 节点轻量应用服务器这是上新了，不知线路如何？","url":"https://www.v2ex.com/t/775103","created":1620269120,"content":"##  旧版 1c1g ssd 25g\r\n![]( https://cloud.onekeyes.cn/index.php/s/cp6JSCfCKx4Pbq6/preview)\r\n##  新版 2c1g essd 40g\r\n![]( https://cloud.onekeyes.cn/index.php/s/w7ecyF4GaKM6irz/preview)","content_rendered":"<h2>旧版 1c1g ssd 25g</h2>\n<p><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://cloud.onekeyes.cn/index.php/s/cp6JSCfCKx4Pbq6/preview\"/></p>\n<h2>新版 2c1g essd 40g</h2>\n<p><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://cloud.onekeyes.cn/index.php/s/w7ecyF4GaKM6irz/preview\"/></p>\n","last_modified":1620269120,"replies":24,"id":775103},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_large.png?m=1620106885","name":"career","avatar_normal":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_normal.png?m=1620106885","title":"职场话题","url":"https://www.v2ex.com/go/career","topics":11397,"footer":"","header":"这里，我们聊聊那些工作中遇到的开心和不开心的事。","title_alternative":"Career","avatar_mini":"https://cdn.v2ex.com/navatar/4ea0/6fbc/770_mini.png?m=1620106885","stars":2026,"aliases":[],"root":false,"id":770,"parent_node_name":"work"},"member":{"username":"liudaolunhuibl","website":"","github":null,"psn":null,"avatar_normal":"https://cdn.v2ex.com/avatar/37d4/6957/504746_mini.png?m=1619054801","bio":"","url":"https://www.v2ex.com/u/liudaolunhuibl","tagline":"","twitter":null,"created":1597971891,"avatar_large":"https://cdn.v2ex.com/avatar/37d4/6957/504746_mini.png?m=1619054801","avatar_mini":"https://cdn.v2ex.com/avatar/37d4/6957/504746_mini.png?m=1619054801","location":"","btc":null,"id":504746},"last_reply_by":"icyalala","last_touched":1620271128,"title":"看来部分人是觉得试用期只是公司对你的考察期不是你对公司的考察期？","url":"https://www.v2ex.com/t/775072","created":1620264277,"content":"除非一些特别大的厂你在脉脉或者知乎上可以很轻松的搜索到这个公司的信息但是大部分公司的详细信息你在入职之前还是无从得知的，面试的时候会简单问问应聘的部门大概做什么也会问 HR 一些福利等等，但是加班、领导关系甚至你负责的项目的技术栈（面试的时候部分面试官会对你入职之后负责的项目的技术栈回答得很含糊那你就要注意了多半是老项目，上一个受害者刚刚跑路等人接盘）这些你在入职之前还是无从知晓的，所以才有了试用期，试用期不仅仅是公司可以随时让你走人你也可以随时开除你的老板，双向选择嘛","content_rendered":"<p>除非一些特别大的厂你在脉脉或者知乎上可以很轻松的搜索到这个公司的信息但是大部分公司的详细信息你在入职之前还是无从得知的，面试的时候会简单问问应聘的部门大概做什么也会问 HR 一些福利等等，但是加班、领导关系甚至你负责的项目的技术栈（面试的时候部分面试官会对你入职之后负责的项目的技术栈回答得很含糊那你就要注意了多半是老项目，上一个受害者刚刚跑路等人接盘）这些你在入职之前还是无从知晓的，所以才有了试用期，试用期不仅仅是公司可以随时让你走人你也可以随时开除你的老板，双向选择嘛</p>\n","last_modified":1620264308,"replies":15,"id":775072},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1620107083","name":"programmer","avatar_normal":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1620107083","title":"程序员","url":"https://www.v2ex.com/go/programmer","topics":44354,"footer":"","header":"While code monkeys are not eating bananas, they're coding.","title_alternative":"Programmer","avatar_mini":"https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1620107083","stars":7361,"aliases":[],"root":false,"id":300,"parent_node_name":"computer"},"member":{"username":"Girl66","website":null,"github":null,"psn":null,"avatar_normal":"https://cdn.v2ex.com/avatar/90c7/3484/544435_mini.png?m=1620110110","bio":null,"url":"https://www.v2ex.com/u/Girl66","tagline":null,"twitter":null,"created":1620109415,"avatar_large":"https://cdn.v2ex.com/avatar/90c7/3484/544435_mini.png?m=1620110110","avatar_mini":"https://cdn.v2ex.com/avatar/90c7/3484/544435_mini.png?m=1620110110","location":null,"btc":null,"id":544435},"last_reply_by":"wipbssldo","last_touched":1620268871,"title":"请教各位: 苹果 testflight 审核被拒: 不能从对象存储 CDN 得到数据来加载页面.","url":"https://www.v2ex.com/t/775066","created":1620259304,"content":"请教各位帅锅: 我的苹果 testflight 审核被拒,违反\"Guideline 2.1 - Performance - App Completeness\"条款:\r\n\r\n出错: 不能从对象存储 CDN 得到数据来加载页面.\r\n现象: 打开 APP 登录成功后显示空白页面.\r\n\r\nAPP 数据来源:\r\n1. 数据是存在猫云的对象存储上的, 外面套了个 CDN: 通过 http 网址(没有开 https)直接下载文件(URLSession.shared.downloadTask)\r\n2. APP 服务器也没有开启 ipv6\r\n\r\n我的问题:\r\n1. APP 在苹果审核时既然可以登录, 说明访问 APP 服务器是正常的, 那么为什么就不能从对象存储的 CDN 中获取数据?\r\n2. 不能从存储的 CDN 中获取数据是因为对象存储对应的网址没有开启 https 呢, 还是 app 服务器没开启 ipv6 问题?\r\n3. 有没有其他原因导致苹果审核时不能从国内的 CDN/对象存储中获取数据?\r\n4. 有没有方法能解决上述问题?\r\n\r\n\r\n小妹第一次提交审核, 很多都不懂, 请各位指教,谢谢.","content_rendered":"请教各位帅锅: 我的苹果 testflight 审核被拒,违反\"Guideline 2.1 - Performance - App Completeness\"条款:<br /><br />出错: 不能从对象存储 CDN 得到数据来加载页面.<br />现象: 打开 APP 登录成功后显示空白页面.<br /><br />APP 数据来源:<br />1. 数据是存在猫云的对象存储上的, 外面套了个 CDN: 通过 http 网址(没有开 https)直接下载文件(URLSession.shared.downloadTask)<br />2. APP 服务器也没有开启 ipv6<br /><br />我的问题:<br />1. APP 在苹果审核时既然可以登录, 说明访问 APP 服务器是正常的, 那么为什么就不能从对象存储的 CDN 中获取数据?<br />2. 不能从存储的 CDN 中获取数据是因为对象存储对应的网址没有开启 https 呢, 还是 app 服务器没开启 ipv6 问题?<br />3. 有没有其他原因导致苹果审核时不能从国内的 CDN/对象存储中获取数据?<br />4. 有没有方法能解决上述问题?<br /><br /><br />小妹第一次提交审核, 很多都不懂, 请各位指教,谢谢.","last_modified":1620259343,"replies":14,"id":775066},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_large.png?m=1615111825","name":"apple","avatar_normal":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_normal.png?m=1615111825","title":"Apple","url":"https://www.v2ex.com/go/apple","topics":14756,"footer":"","header":"设计了 <a href=\"/go/watch\">Apple Watch</a>，<a href=\"/go/ipad\">iPad</a>，<a href=\"/go/iphone\">iPhone</a>，<a href=\"/go/imac\">iMac</a> 及 <a href=\"/go/mbp\">MacBook Pro</a> 等电子产品的美国公司。","title_alternative":"Apple","avatar_mini":"https://cdn.v2ex.com/navatar/6cdd/60ea/184_mini.png?m=1615111825","stars":1799,"aliases":[],"root":false,"id":184,"parent_node_name":"hardware"},"member":{"username":"Hashtagoo","website":"","github":"","psn":"","avatar_normal":"https://cdn.v2ex.com/avatar/6f14/cf24/305007_mini.png?m=1555573654","bio":"","url":"https://www.v2ex.com/u/Hashtagoo","tagline":"","twitter":"","created":1522483758,"avatar_large":"https://cdn.v2ex.com/avatar/6f14/cf24/305007_mini.png?m=1555573654","avatar_mini":"https://cdn.v2ex.com/avatar/6f14/cf24/305007_mini.png?m=1555573654","location":"","btc":"","id":305007},"last_reply_by":"leavic","last_touched":1620272605,"title":"19 年的 Watch S4，冲动买了 AC+,两年期到，巨亏。","url":"https://www.v2ex.com/t/775092","created":1620268124,"content":"购于上海环贸 iapm,寻思手表容易摔，买个 AC+吧（内心 os 大不了两年期到加钱换新\r\n如今 S6 都出来了，手表也没碎，还剩两个月到期，退 AC+，不值，再花 528 换新好像更不值 ：）\r\n巨亏。","content_rendered":"<p>购于上海环贸 iapm,寻思手表容易摔，买个 AC+吧（内心 os 大不了两年期到加钱换新\n如今 S6 都出来了，手表也没碎，还剩两个月到期，退 AC+，不值，再花 528 换新好像更不值 ：）\n巨亏。</p>\n","last_modified":1620268124,"replies":12,"id":775092},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/df7f/28ac/791_large.png?m=1563424621","name":"fe","avatar_normal":"https://cdn.v2ex.com/navatar/df7f/28ac/791_normal.png?m=1563424621","title":"前端开发","url":"https://www.v2ex.com/go/fe","topics":2213,"footer":"","header":"","title_alternative":"Frontend","avatar_mini":"https://cdn.v2ex.com/navatar/df7f/28ac/791_mini.png?m=1563424621","stars":1059,"aliases":[],"root":false,"id":791,"parent_node_name":"programmer"},"member":{"username":"ezshine","website":"www.jnsii.com","github":"ezshine","psn":"ezshine_mac","avatar_normal":"https://cdn.v2ex.com/avatar/8e67/a552/145670_mini.png?m=1619582315","bio":"","url":"https://www.v2ex.com/u/ezshine","tagline":"爱整活儿的大帅老猿","twitter":"","created":1446607415,"avatar_large":"https://cdn.v2ex.com/avatar/8e67/a552/145670_mini.png?m=1619582315","avatar_mini":"https://cdn.v2ex.com/avatar/8e67/a552/145670_mini.png?m=1619582315","location":"","btc":"","id":145670},"last_reply_by":"Rxianbei","last_touched":1620272005,"title":"文字烟花特效，用 JS 代码示爱！程序员小姐姐用这个代码挽回了爱情~","url":"https://www.v2ex.com/t/775095","created":1620268497,"content":"# 前言\r\n\r\n之前我出了一个[如何在网页里使用原生 JS 开发放烟花效果]( https://www.v2ex.com/t/773999#reply2)的教程。\r\n\r\n![image.png]( https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33d4009dca134a969e6145cba339dadc~tplv-k3u1fbpfcp-watermark.image)\r\n\r\n竟然有一个前端小阿姨问我，如果想要烟花放出来是文字的话怎么实现，她要给男朋友做一个。\r\n\r\n好家伙，这狗粮洒一地呀\r\n\r\n![171253fc29abd17b89974c04784db038.gif]( https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/018336172ea14186bda6e35dbf2eb1a4~tplv-k3u1fbpfcp-watermark.image)\r\n\r\n那狗粮不能我一个人吃，分享出来，大家一起吃。\r\n\r\n此文配有 [视频教程]( https://www.bilibili.com/video/BV17p4y1473o)，边吃边看，狗粮更香。\r\n\r\n\r\n# 互动话题\r\n\r\n你身边有这样的程序员小姐姐吗？\r\n\r\n1. 没有，你编的\r\n2. 有呀，我认识\r\n\r\n[点击参与投票]( https://www.bilibili.com/video/BV17p4y1473o)\r\n\r\n\r\n# 先改造一下烟花的源代码\r\n\r\n之前烟花源码里的核心是，我们在创建烟花粒子的时候，赋值了烟花绽放的原点`x`,`y`和圆形烟花的半径`radius`。在绘制烟花动效时，半径不断加大，烟花的动效就出来。\r\n\r\n~~~javascript\r\n//篇幅限制，仅展现部分代码\r\nfunction createFireworks(x, y) {\r\n    var count = 100;\r\n    for (var i = 0; i < count; i++) {\r\n        var p = {};\r\n        \r\n        p.x = x;\r\n        p.y = y;\r\n        p.speed = (Math.random() * 5) + .4;\r\n        p.radius = p.speed;\r\n    }\r\n}\r\nfunction drawFireworks(){\r\n    for (var i = 0; i < particles.length; i++) {\r\n        var p = particles[i];\r\n        var vx = Math.cos(p.radians) * p.radius;\r\n        var vy = Math.sin(p.radians) * p.radius + 0.4;\r\n\r\n        p.x += vx;\r\n        p.y += vy;\r\n        p.radius *= 1 - p.speed / 100;\r\n    }\r\n}\r\n~~~\r\n\r\n但要实现文字烟花，我们一开始就要把烟花最后的`x`,`y`坐标全部精确的计算出来。所以这个烟花的绘制，我们要更改一下逻辑。在`createFireworks`阶段，就计算出单个粒子的`起点 x,y`和`终点 fx,fy`。\r\n\r\n代码修改后如下\r\n\r\n~~~javascript\r\n//篇幅限制，仅展现部分代码\r\nfunction createFireworks(x, y){\r\n    var count = 100;\r\n    for (var i = 0; i < count; i++) {\r\n        var angle = 360 / count * i;\r\n\r\n        var p = {};\r\n        p.x = x;\r\n        p.y = y;\r\n        p.radians = angle * Math.PI / 180;\r\n\r\n        p.radius = Math.random()*81+50;\r\n\r\n        p.fx = x + Math.cos(radians) * p.radius;\r\n        p.fy = y + Math.sin(radians) * p.radius;\r\n    }\r\n}\r\nfunction drawFireworks() {\r\n    for (var i = 0; i < particles.length; i++) {\r\n        var p = particles[i];\r\n\r\n        p.x += (p.fx - p.x)/10;\r\n        p.y += (p.fy - p.y)/10-(p.alpha-1)*p.speed;\r\n    }\r\n}\r\n~~~\r\n\r\n这样我们就完成了第一步改造，后续我们要把文字写在画布上，并且将其转换为点阵数组，也就是所有烟花粒子的终点坐标。\r\n\r\n# 画布绘制文字\r\n\r\n其实和之前那篇[《使用 Javascript 制作 BadApple 字符画视频》]( https://www.v2ex.com/t/774257#reply11)的原理是一样的。通过`canvas`的 API`getImageData`来获得画布指定区域内的全部点阵信息（`rgba`数组）。\r\n\r\n将`createFireworks`方法改造如下\r\n\r\n~~~javascript\r\nfunction createFireworks(x,y,text=\"\"){\r\n    if(text!=\"\"){\r\n        //绘制文字\r\n    }else{\r\n        //原有的烟花代码\r\n    }\r\n}\r\n~~~\r\n\r\n传递一个`text`参数，当此参数不为空时，我们进入文字烟花的绘制逻辑。\r\n\r\n~~~javascript\r\nvar fontSize = 120;\r\nvar textHeight = fontSize;\r\ncontext.font=fontSize+\"px Verdana\";\r\ncontext.fillStyle = \"#ffffff\";\t\r\ncontext.fillText(text,0,textHeight);\r\n~~~\r\n\r\n![image.png]( https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bfc02ff6fe9b45e9943aa09791186744~tplv-k3u1fbpfcp-watermark.image)\r\n\r\n# 获取点阵数组\r\n\r\n这样我们就能把字绘制在画布上了，接着我们使用`getImageData`来获得并裁剪点阵信息，因为我们只要一部分的点阵。\r\n\r\n~~~javascript\r\nvar imgData = textctx.getImageData(0,0,textWidth,textHeight);\r\n\r\nfor (var h = 0; h < textHeight; h+=gap) {\r\n    for(var w = 0; w < textWidth; w+=gap){\r\n            var position = (textWidth * h + w) * 4;\r\n            var r = imgData.data[position], g = imgData.data[position + 1], b = imgData.data[position + 2], a = imgData.data[position + 3];\r\n    }\r\n}\r\n~~~\r\n\r\n这样我们就拿到了画布里文字绘制区域的全部点阵数据，数据的格式为\r\n\r\n~~~\r\n[r,g,b,a,r,g,b,a,r,g,b,a]\r\n~~~\r\n\r\n我们通过一个`gap`值来跳跃间隔裁剪数据。由于画布是黑色，所以`r`,`g`,`b`都为`0`的点阵我们就不绘制了，现在将间隔的点阵信息再次绘制到画布中。\r\n\r\n~~~javascript\r\nvar fx = x + w - textWidth/2;\r\nvar fy = y + h - textHeight/2;\r\n\r\ncontext.fillStyle = \"#ffffff\";\r\ncontext.fillRect(fx,fy,1,1);\r\n~~~\r\n\r\n我们就会看见~\r\n\r\n\r\n![image.png]( https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efff8466670b4ed6acfaf4dcfa8915b9~tplv-k3u1fbpfcp-watermark.image)\r\n\r\n![image.png]( https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2dae21c5731f4970875a9d6ed7d3ecb0~tplv-k3u1fbpfcp-watermark.image)\r\n\r\n太棒了，这就是我们最终需要的文字烟花粒子的终点信息呀！\r\n\r\n现在我们遍历全部的点阵，并创建烟花粒子吧！\r\n\r\n~~~javascript\r\nfor (var h = 0; h < textHeight; h+=gap) {\r\n    for(var w = 0; w < textWidth; w+=gap){\r\n            var position = (textWidth * h + w) * 4;\r\n            var r = imgData.data[position], g = imgData.data[position + 1], b = imgData.data[position + 2];\r\n\r\n            if(r+g+b==0)continue;\r\n\r\n            var p = {};\r\n            p.x = x;\r\n            p.y = y;\r\n            p.fx = x + w - textWidth/2;\r\n            p.fy = y + h - textHeight/2;\r\n\r\n            p.size = Math.floor(Math.random()*2)+1;\r\n            p.speed = 1;\r\n\r\n            setupColors(p);\r\n\r\n            particles.push(p);\r\n    }\r\n}\r\n~~~\r\n\r\n# 文字烟花来了\r\n\r\n至此，文字烟花效果，我们就实现了！！！\r\n\r\n![2021-05-03 21_27_34.gif]( https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70feb20242ae4209a46e8c0c4a3fc5b3~tplv-k3u1fbpfcp-watermark.image)\r\n\r\n# 用它示爱！\r\n\r\n~~~javascript\r\ncreateFireworks(x, y,[\"杨幂\",\"我爱你\",\"永远\"][Math.floor(Math.random()*3)]);\r\n~~~\r\n\r\n![2021-05-03 22_26_55.gif]( https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbf670c32e404c6eb820c4c8caa94be6~tplv-k3u1fbpfcp-watermark.image)\r\n\r\n# 关注我获取源码\r\n\r\n微信搜索“`大帅老猿`”并回复“`烟花`”即可获得本文全部源码","content_rendered":"<h1>前言</h1>\n<p>之前我出了一个<a href=\"https://www.v2ex.com/t/773999#reply2\" rel=\"nofollow\">如何在网页里使用原生 JS 开发放烟花效果</a>的教程。</p>\n<p><img alt=\"image.png\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33d4009dca134a969e6145cba339dadc%7Etplv-k3u1fbpfcp-watermark.image\"/></p>\n<p>竟然有一个前端小阿姨问我，如果想要烟花放出来是文字的话怎么实现，她要给男朋友做一个。</p>\n<p>好家伙，这狗粮洒一地呀</p>\n<p><img alt=\"171253fc29abd17b89974c04784db038.gif\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/018336172ea14186bda6e35dbf2eb1a4%7Etplv-k3u1fbpfcp-watermark.image\"/></p>\n<p>那狗粮不能我一个人吃，分享出来，大家一起吃。</p>\n<p>此文配有 <a href=\"https://www.bilibili.com/video/BV17p4y1473o\" rel=\"nofollow\">视频教程</a>，边吃边看，狗粮更香。</p>\n<h1>互动话题</h1>\n<p>你身边有这样的程序员小姐姐吗？</p>\n<ol>\n<li>没有，你编的</li>\n<li>有呀，我认识</li>\n</ol>\n<p><a href=\"https://www.bilibili.com/video/BV17p4y1473o\" rel=\"nofollow\">点击参与投票</a></p>\n<h1>先改造一下烟花的源代码</h1>\n<p>之前烟花源码里的核心是，我们在创建烟花粒子的时候，赋值了烟花绽放的原点<code>x</code>,<code>y</code>和圆形烟花的半径<code>radius</code>。在绘制烟花动效时，半径不断加大，烟花的动效就出来。</p>\n<pre><code class=\"language-javascript\">//篇幅限制，仅展现部分代码\nfunction createFireworks(x, y) {\n    var count = 100;\n    for (var i = 0; i &lt; count; i++) {\n        var p = {};\n        \n        p.x = x;\n        p.y = y;\n        p.speed = (Math.random() * 5) + .4;\n        p.radius = p.speed;\n    }\n}\nfunction drawFireworks(){\n    for (var i = 0; i &lt; particles.length; i++) {\n        var p = particles[i];\n        var vx = Math.cos(p.radians) * p.radius;\n        var vy = Math.sin(p.radians) * p.radius + 0.4;\n\n        p.x += vx;\n        p.y += vy;\n        p.radius *= 1 - p.speed / 100;\n    }\n}\n</code></pre>\n<p>但要实现文字烟花，我们一开始就要把烟花最后的<code>x</code>,<code>y</code>坐标全部精确的计算出来。所以这个烟花的绘制，我们要更改一下逻辑。在<code>createFireworks</code>阶段，就计算出单个粒子的<code>起点 x,y</code>和<code>终点 fx,fy</code>。</p>\n<p>代码修改后如下</p>\n<pre><code class=\"language-javascript\">//篇幅限制，仅展现部分代码\nfunction createFireworks(x, y){\n    var count = 100;\n    for (var i = 0; i &lt; count; i++) {\n        var angle = 360 / count * i;\n\n        var p = {};\n        p.x = x;\n        p.y = y;\n        p.radians = angle * Math.PI / 180;\n\n        p.radius = Math.random()*81+50;\n\n        p.fx = x + Math.cos(radians) * p.radius;\n        p.fy = y + Math.sin(radians) * p.radius;\n    }\n}\nfunction drawFireworks() {\n    for (var i = 0; i &lt; particles.length; i++) {\n        var p = particles[i];\n\n        p.x += (p.fx - p.x)/10;\n        p.y += (p.fy - p.y)/10-(p.alpha-1)*p.speed;\n    }\n}\n</code></pre>\n<p>这样我们就完成了第一步改造，后续我们要把文字写在画布上，并且将其转换为点阵数组，也就是所有烟花粒子的终点坐标。</p>\n<h1>画布绘制文字</h1>\n<p>其实和之前那篇<a href=\"https://www.v2ex.com/t/774257#reply11\" rel=\"nofollow\">《使用 Javascript 制作 BadApple 字符画视频》</a>的原理是一样的。通过<code>canvas</code>的 API<code>getImageData</code>来获得画布指定区域内的全部点阵信息（<code>rgba</code>数组）。</p>\n<p>将<code>createFireworks</code>方法改造如下</p>\n<pre><code class=\"language-javascript\">function createFireworks(x,y,text=\"\"){\n    if(text!=\"\"){\n        //绘制文字\n    }else{\n        //原有的烟花代码\n    }\n}\n</code></pre>\n<p>传递一个<code>text</code>参数，当此参数不为空时，我们进入文字烟花的绘制逻辑。</p>\n<pre><code class=\"language-javascript\">var fontSize = 120;\nvar textHeight = fontSize;\ncontext.font=fontSize+\"px Verdana\";\ncontext.fillStyle = \"#ffffff\";\t\ncontext.fillText(text,0,textHeight);\n</code></pre>\n<p><img alt=\"image.png\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bfc02ff6fe9b45e9943aa09791186744%7Etplv-k3u1fbpfcp-watermark.image\"/></p>\n<h1>获取点阵数组</h1>\n<p>这样我们就能把字绘制在画布上了，接着我们使用<code>getImageData</code>来获得并裁剪点阵信息，因为我们只要一部分的点阵。</p>\n<pre><code class=\"language-javascript\">var imgData = textctx.getImageData(0,0,textWidth,textHeight);\n\nfor (var h = 0; h &lt; textHeight; h+=gap) {\n    for(var w = 0; w &lt; textWidth; w+=gap){\n            var position = (textWidth * h + w) * 4;\n            var r = imgData.data[position], g = imgData.data[position + 1], b = imgData.data[position + 2], a = imgData.data[position + 3];\n    }\n}\n</code></pre>\n<p>这样我们就拿到了画布里文字绘制区域的全部点阵数据，数据的格式为</p>\n<pre><code>[r,g,b,a,r,g,b,a,r,g,b,a]\n</code></pre>\n<p>我们通过一个<code>gap</code>值来跳跃间隔裁剪数据。由于画布是黑色，所以<code>r</code>,<code>g</code>,<code>b</code>都为<code>0</code>的点阵我们就不绘制了，现在将间隔的点阵信息再次绘制到画布中。</p>\n<pre><code class=\"language-javascript\">var fx = x + w - textWidth/2;\nvar fy = y + h - textHeight/2;\n\ncontext.fillStyle = \"#ffffff\";\ncontext.fillRect(fx,fy,1,1);\n</code></pre>\n<p>我们就会看见~</p>\n<p><img alt=\"image.png\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efff8466670b4ed6acfaf4dcfa8915b9%7Etplv-k3u1fbpfcp-watermark.image\"/></p>\n<p><img alt=\"image.png\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2dae21c5731f4970875a9d6ed7d3ecb0%7Etplv-k3u1fbpfcp-watermark.image\"/></p>\n<p>太棒了，这就是我们最终需要的文字烟花粒子的终点信息呀！</p>\n<p>现在我们遍历全部的点阵，并创建烟花粒子吧！</p>\n<pre><code class=\"language-javascript\">for (var h = 0; h &lt; textHeight; h+=gap) {\n    for(var w = 0; w &lt; textWidth; w+=gap){\n            var position = (textWidth * h + w) * 4;\n            var r = imgData.data[position], g = imgData.data[position + 1], b = imgData.data[position + 2];\n\n            if(r+g+b==0)continue;\n\n            var p = {};\n            p.x = x;\n            p.y = y;\n            p.fx = x + w - textWidth/2;\n            p.fy = y + h - textHeight/2;\n\n            p.size = Math.floor(Math.random()*2)+1;\n            p.speed = 1;\n\n            setupColors(p);\n\n            particles.push(p);\n    }\n}\n</code></pre>\n<h1>文字烟花来了</h1>\n<p>至此，文字烟花效果，我们就实现了！！！</p>\n<p><img alt=\"2021-05-03 21_27_34.gif\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70feb20242ae4209a46e8c0c4a3fc5b3%7Etplv-k3u1fbpfcp-watermark.image\"/></p>\n<h1>用它示爱！</h1>\n<pre><code class=\"language-javascript\">createFireworks(x, y,[\"杨幂\",\"我爱你\",\"永远\"][Math.floor(Math.random()*3)]);\n</code></pre>\n<p><img alt=\"2021-05-03 22_26_55.gif\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbf670c32e404c6eb820c4c8caa94be6%7Etplv-k3u1fbpfcp-watermark.image\"/></p>\n<h1>关注我获取源码</h1>\n<p>微信搜索“<code>大帅老猿</code>”并回复“<code>烟花</code>”即可获得本文全部源码</p>\n","last_modified":1620268497,"replies":9,"id":775095},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/f749/09ac/430_large.png?m=1347578950","name":"icloud","avatar_normal":"https://cdn.v2ex.com/navatar/f749/09ac/430_normal.png?m=1347578950","title":"iCloud","url":"https://www.v2ex.com/go/icloud","topics":623,"footer":null,"header":"Store contacts, calendars, photos, music, books, apps and more in the cloud and access them on all your devices.","title_alternative":"iCloud","avatar_mini":"https://cdn.v2ex.com/navatar/f749/09ac/430_mini.png?m=1347578950","stars":141,"aliases":[],"root":false,"id":430,"parent_node_name":"apple"},"member":{"username":"Leviathann","website":null,"github":null,"psn":null,"avatar_normal":"https://cdn.v2ex.com/gravatar/d3b22910a49ecf620ab67790d7f594eb?s=24&d=retro","bio":null,"url":"https://www.v2ex.com/u/Leviathann","tagline":null,"twitter":null,"created":1463667175,"avatar_large":"https://cdn.v2ex.com/gravatar/d3b22910a49ecf620ab67790d7f594eb?s=24&d=retro","avatar_mini":"https://cdn.v2ex.com/gravatar/d3b22910a49ecf620ab67790d7f594eb?s=24&d=retro","location":null,"btc":null,"id":173846},"last_reply_by":"xuegy","last_touched":1620272342,"title":"提醒我 icloud 容量不够，点进去看发现有几个 app 都备份过去了（b 站、知乎、qq、微信啥的）每个都占用了大几百 M，这个应用备份是备份了啥啊","url":"https://www.v2ex.com/t/775085","created":1620266682,"content":"","content_rendered":"","last_modified":1620266682,"replies":9,"id":775085},{"node":{"avatar_large":"https://cdn.v2ex.com/navatar/55b3/7c5c/649_large.png?m=1599634467","name":"wechat","avatar_normal":"https://cdn.v2ex.com/navatar/55b3/7c5c/649_normal.png?m=1599634467","title":"微信","url":"https://www.v2ex.com/go/wechat","topics":2592,"footer":"","header":"腾讯旗下的新的移动沟通平台","title_alternative":"WeChat","avatar_mini":"https://cdn.v2ex.com/navatar/55b3/7c5c/649_mini.png?m=1599634467","stars":411,"aliases":[],"root":false,"id":649,"parent_node_name":"internet"},"member":{"username":"Felldeadbird","website":"","github":"","psn":"","avatar_normal":"https://cdn.v2ex.com/avatar/fed6/d910/92455_mini.png?m=1451524610","bio":"","url":"https://www.v2ex.com/u/Felldeadbird","tagline":"","twitter":"","created":1421584639,"avatar_large":"https://cdn.v2ex.com/avatar/fed6/d910/92455_mini.png?m=1451524610","avatar_mini":"https://cdn.v2ex.com/avatar/fed6/d910/92455_mini.png?m=1451524610","location":"","btc":"","id":92455},"last_reply_by":"shoaly","last_touched":1620268421,"title":"微信小程序怎样做多次消息推送？","url":"https://www.v2ex.com/t/775073","created":1620264279,"content":"现在业务实现遇到一个棘手问题，订阅消息只能记录一次有效。根据微信文档说明，订阅消息必须是用户主动点击触发，所以我不能做到用户打开一次页面，就给他申请一次订阅。  \r\n\r\n这样一来，尽管我记录了用户订阅次数，当我推送消息次数消耗完后，再推送就失败了。我看一些其他人的做法，他们是去搞一些长期订阅？ 例如：停车场之类的……  \r\n\r\n所以我要多次主动推送消息给用户，要么申请长期订阅？反之就不可能解决了？","content_rendered":"<p>现在业务实现遇到一个棘手问题，订阅消息只能记录一次有效。根据微信文档说明，订阅消息必须是用户主动点击触发，所以我不能做到用户打开一次页面，就给他申请一次订阅。  </p>\n<p>这样一来，尽管我记录了用户订阅次数，当我推送消息次数消耗完后，再推送就失败了。我看一些其他人的做法，他们是去搞一些长期订阅？ 例如：停车场之类的……  </p>\n<p>所以我要多次主动推送消息给用户，要么申请长期订阅？反之就不可能解决了？</p>\n","last_modified":1620264279,"replies":7,"id":775073}]